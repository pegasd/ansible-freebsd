---
- name: Remove pre/post certbot hooks since using cloudflare
  ansible.builtin.file:
    state: absent
    path: '{{ item }}'
  loop:
    - '{{ web_proxy_letsencrypt_directory }}/renewal-hooks/pre/stop_services'
    - '{{ web_proxy_letsencrypt_directory }}/renewal-hooks/post/start_services'

- name: Certbot cloudflare package
  community.general.pkgng:
    name: 'py{{ web_proxy_python_version | replace(".", "") }}-certbot-dns-cloudflare'
    state: present

- name: Cloudflare authentication directory
  ansible.builtin.file:
    state: directory
    path: '{{ web_proxy_letsencrypt_directory }}/cloudflare'
    mode: '0700'

- name: Cloudflare authentication
  ansible.builtin.template:
    src: cloudflare.auth.j2
    dest: '{{ web_proxy_letsencrypt_directory }}/cloudflare/auth.ini'
    mode: '0600'
  diff: false
...
